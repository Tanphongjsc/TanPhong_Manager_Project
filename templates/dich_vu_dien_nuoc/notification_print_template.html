<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{suggested_filename}}</title>
    <style>
        @page {
            size: A4;
            margin: 15mm;
        }

        body {
            font-family: 'Times New Roman', serif;
            font-size: 10pt;
            line-height: 1.2;
            color: #000;
            margin: 0;
            padding: 0;
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }

        .company-info {
            text-align: left;
            width: 48%;
        }

        .republic-info {
            text-align: center;
            width: 48%;
        }

        .company-name {
            font-weight: bold;
            font-size: 10pt;
            text-transform: uppercase;
            margin-bottom: 3px;
        }

        .company-address {
            font-size: 9pt;
            margin-bottom: 2px;
        }

        .republic-title {
            font-weight: bold;
            font-size: 10pt;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .republic-subtitle {
            font-weight: bold;
            font-size: 9pt;
            margin-bottom: 8px;
        }

        .date-info {
            font-style: italic;
            font-size: 8pt;
        }

        .main-title {
            text-align: center;
            margin: 12px 0 8px 0;
        }

        .main-title h1 {
            font-size: 12pt;
            font-weight: bold;
            text-transform: uppercase;
            margin: 0 0 4px 0;
        }

        .period-info {
            font-size: 10pt;
            margin: 2px 0;
        }

        .greeting-section {
            margin: 10px 0 8px 0;
            text-align: center;
            line-height: 1.2;
        }

        .greeting-section p {
            margin: 3px 0;
        }

        .greeting-section .kinship-label {
            font-weight: normal;
        }

        .company-target {
            font-weight: bold;
            text-transform: uppercase;
        }

        .content-section {
            margin: 10px 0;
            text-align: justify;
            line-height: 1.2;
        }

        .content-section p {
            margin: 3px 0;
        }

        .services-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 9pt;
        }

        .services-table th,
        .services-table td {
            border: 1px solid #000;
            padding: 2px 3px;
            text-align: center;
            vertical-align: middle;
            line-height: 1.1;
        }

        .services-table th {
            font-weight: bold;
            font-size: 9pt;
            height: 35px;
        }

        .services-table td {
            height: 20px;
        }

        .services-table td.left {
            text-align: left;
            padding-left: 6px;
        }

        .services-table td.right {
            text-align: right;
            padding-right: 6px;
        }

        /* Tăng width của cột diễn giải dịch vụ */
        .services-table th:nth-child(2),
        .services-table td:nth-child(2) {
            width: 130px; /* Tăng từ 110px lên 130px */
        }

        .separator-row {
            font-style: italic;
            text-align: left;
            background-color: #f8f8f8;
        }

        .separator-row td {
            padding-left: 10px;
        }

        .total-section .discount-reason {
            font-style: italic;
            font-weight: normal;
            display: block;
            margin-top: 2px;
        }

        .total-section {
            font-weight: bold;
        }

        .total-section td {
            font-weight: bold;
        }

        .total-section td.right {
            font-weight: normal;
        }

        /* Format số thống nhất */
        .number-format {
            font-family: 'Times New Roman', serif;
        }

        .amount-in-words {
            margin: 6px 0;
            text-align: center;
            line-height: 1.2;
        }

        .payment-info {
            margin: 10px 0;
            text-align: justify;
            line-height: 1.1;
        }

        .payment-info p {
            margin: 1px 0;
        }

        .account-number {
            font-weight: bold;
        }

        .notes-section {
            margin-top: 12px;
        }

        .note-title {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .note-lines {
            margin-bottom: 6px;
            line-height: 1.0;
        }

        .note-lines p {
            margin: 0px 0;
        }

        .footer-info {
            font-style: italic;
            font-size: 8pt;
            margin-bottom: 10px;
        }

        .footer-info p {
            margin: 1px 0;
        }

        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .signature-left {
            text-align: left;
        }

        .signature-right {
            text-align: center;
        }

        .signature-date {
            margin-bottom: 10px;
            font-style: italic;
            font-size: 8pt;
        }

        .signature-title {
            font-weight: bold;
            margin-bottom: 35px;
            font-size: 9pt;
        }

        .signature-name {
            font-weight: bold;
            font-size: 8pt;
        }

        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }

        /* Định dạng số để hiển thị tối đa 1 chữ số thập phân */
        .number-format {
            text-align: right;
        }
        
        /* CSS cho các số trong bảng */
        .services-table td:nth-child(4),
        .services-table td:nth-child(5),
        .services-table td:nth-child(6),
        .services-table td:nth-child(7),
        .services-table td:nth-child(8),
        .services-table td:nth-child(9),
        .services-table td:nth-child(10),
        .services-table td:nth-child(11) {
            text-align: right;
        }
    </style>
    <!-- Code JavaScript trong template đã hoạt động tốt -->
    <script>
        // Đặt tên file mặc định khi print/save
        window.addEventListener('beforeprint', function() {
            document.title = '{{suggested_filename}}';
        });
        
        // Đặt tên file ngay khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            document.title = '{{suggested_filename}}';
        });
    </script>
</head>
<body>
    <!-- Header Section -->
    <div class="header-section">
        <div class="company-info">
            <div class="company-name">CÔNG TY CỔ PHẦN TÂN PHONG</div>
            <div class="company-address">Đ/c: Cụm B KCN Đồng Lạng, Phù Ninh, Phú Thọ</div>
        </div>
        <div class="republic-info">
            <div class="republic-title">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</div>
            <div class="republic-subtitle">Độc Lập - Tự Do - Hạnh Phúc</div>
            <div class="date-info">Tân Phong, ngày <span id="day">{{day}}</span> tháng <span id="month">{{month}}</span> năm <span id="year">{{year}}</span></div>
        </div>
    </div>
    
    <!-- Main Title -->
    <div class="main-title">
        <h1>THÔNG BÁO TIỀN PHÍ DỊCH VỤ</h1>
        <div class="period-info">(Tháng <span id="period-month">{{period_month}}</span> năm <span id="period-year">{{period_year}}</span>)</div>
    </div>
    
    <!-- Greeting Section -->
    <div class="greeting-section">
        <p><span class="kinship-label">KÍNH GỬI:</span> <span class="company-target" id="company-name">{{company_name}}</span></p>
    </div>
    
    <!-- Content Section -->
    <div class="content-section">
        <p>Công ty cổ phần Tân Phong xin thông báo tới Quý công ty, trong tháng <span id="period-month-text">{{period_month}}</span> năm <span id="period-year-text">{{period_year}}</span>, Quý Công ty đã sử dụng hết số tiền các dịch vụ như sau:</p>
    </div>
    
    <!-- Services Table -->
    <table class="services-table">
        <thead>
            <tr>
                <th width="25">STT</th>
                <th width="130">Diễn giải dịch vụ</th>
                <th width="30">ĐVT</th>
                <th width="50">Chỉ số cũ</th>
                <th width="50">Chỉ số mới</th>
                <th width="30">Hệ số</th>
                <th width="60">Đơn giá</th>
                <th width="50">Số sử dụng</th>
                <th width="60">Thành tiền</th>
                <th width="40">Thuế (8%)</th>
                <th width="70">Tiền sau thuế</th>
            </tr>
        </thead>
        <tbody id="services-tbody">
            {{services_rows|safe}}
            <tr class="separator-row">
                <td colspan="11" class="left">- Nguyên nhân phát sinh (nếu có):</td>
            </tr>
            <tr class="total-section">
                <td class="left" style="text-align: center;">I.</td>
                <td class="left" colspan="7">Tổng cộng:</td>
                <td class="right number-format">{{total_before_tax}}</td>
                <td class="right number-format">{{tax_amount}}</td>
                <td class="right number-format">{{total_after_tax}}</td>
            </tr>
            <tr class="total-section">
                <td class="left" style="text-align: center;">II.</td>
                <td class="left" colspan="7">
                    Số tiền giảm trừ (Nếu có):
                    <span class="discount-reason">Lý do giảm trừ:</span>
                </td>
                <td colspan="2"></td>
                <td class="right number-format">{{discount_amount}}</td>
            </tr>
            <tr class="total-section">
                <td class="left" style="text-align: center;">III.</td>
                <td class="left" colspan="7">Số tiền thanh toán tháng này:</td>
                <td colspan="2"></td>
                <td class="right number-format">{{final_amount}}</td>
            </tr>
        </tbody>
    </table>
    
    <!-- Amount in Words -->
    <div class="amount-in-words">
        <strong>Bằng chữ: <span id="amount-words">{{amount_in_words}}</span></strong>
    </div>
    
    <!-- Payment Information -->
        
    <div class="payment-info">
        <p>Vậy đề nghị Quý công ty quyết toán cho chúng tôi theo thông báo này bằng tiền mặt tại phòng kế toán trước ngày <span id="payment-day">{{payment_day}}</span> tháng <span id="payment-month">{{payment_month}}</span> năm <span id="payment-year">{{payment_year}}</span></p>
        <p>Hoặc thanh toán bằng hình thức chuyển khoản đến số tài khoản dưới đây trước ngày <span id="payment-day-2">{{payment_day}}</span> tháng <span id="payment-month-2">{{payment_month}}</span> năm <span id="payment-year-2">{{payment_year}}</span></p>
        <p>Số tài khoản: <span class="account-number">2700 201 007928</span> Tại ngân hàng Agribank - CN tỉnh Phú Thọ</p>
        <p>Sau ngày <span id="payment-day-3">{{payment_day}}</span> tháng <span id="payment-month-3">{{payment_month}}</span> năm <span id="payment-year-3">{{payment_year}}</span> nếu chưa thanh toán, Công ty cổ phần Tân Phong sẽ ngưng cung cấp dịch vụ trên.</p>
        <p>Rất mong sự hợp tác giữa hai công ty ngày càng phát triển</p>
        <p>Xin trân Trọng cảm ơn !</p>
    </div>
    
    <!-- Notes Section -->
    <div class="notes-section">
        <div class="note-title">- Ghi chú:</div>
        <div class="note-lines">
            <p>..................................................................................................................................................</p>
            <p>..................................................................................................................................................</p>
        </div>
        
        <div class="footer-info">
            <p>- Nơi nhận: Như kính gửi</p>
            <p>- Lưu: Phòng Tài chính - Kế toán</p>
        </div>
    </div>
    
    <!-- Signature Section -->
    <div class="signature-section">
        <div class="signature-left">
            <div class="signature-title">Bên sử dụng</div>
            <div style="margin-top: 50px; font-size: 9pt;">(Ký, ghi rõ họ tên)</div>
        </div>
        <div class="signature-right">
            <div class="signature-date">Phù Ninh, Ngày <span id="signature-day">{{day}}</span> tháng <span id="signature-month">{{month}}</span> năm <span id="signature-year">{{year}}</span></div>
            <div class="signature-title">TM. Công ty cổ phần Tân Phong</div>
        </div>
    </div>
</body>
</html>