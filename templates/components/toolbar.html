{% comment %}
  Universal Toolbar Component v2 - Fully Dynamic
  
  Parameters cải tiến:
    - filter_options: (List) Danh sách các lựa chọn cho bộ lọc nhanh.
      Cấu trúc mong đợi: List các object hoặc tuple [(value, label), ...]
    - filter_label: (String) Label mặc định (VD: "Trạng thái", "Phòng ban"...)
    - filter_field: (String) Tên field name cho thẻ select (VD: "status", "dept_id")
{% endcomment %}

{% comment %}
  Universal Toolbar Component v3 (Final Synced)
  Author: Refactored by Gemini
  
  Updates:
    - Thêm thẻ <form id="filter-form"> để TableManager.js có thể gom nhóm filters.
    - Input search nằm ngoài form filter để tránh conflict sự kiện (tùy logic, nhưng để riêng an toàn hơn cho logic 'input' vs 'change').
{% endcomment %}

<div class="bg-white py-2 mb-2">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
        
        {# SEARCH - Nhỏ gọn hơn #}
        <div class="flex-1 w-full sm:max-w-xs">
            <div class="relative">
                <input type="text" 
                       id="{{ search_id|default:'search-input' }}"
                       value="{{ search_val|default:'' }}"
                       placeholder="{{ search_placeholder|default:'Tìm kiếm...' }}" 
                       class="w-full pl-8 pr-3 py-1 text-xs border border-slate-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition-all">
                
                <svg class="absolute left-2.5 top-1.5 h-3.5 w-3.5 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
            </div>
        </div>
        
        {# FILTERS & ACTIONS - Compact #}
        <div class="flex flex-wrap items-center gap-1.5 justify-end">
            
            <form id="{{ filter_form_id|default:'filter-form' }}" class="contents">
                {% if filter_options %}
                <select name="{{ filter_field|default:'status' }}" 
                        class="px-2.5 py-1 text-xs border border-slate-300 rounded-md focus:ring-1 focus:ring-blue-500 bg-white cursor-pointer">
                    <option value="">{{ filter_label|default:'Tất cả' }}</option>
                    {% for item in filter_options %}
                        <option value="{{ item.value }}" {% if request.GET.status == item.value %}selected{% endif %}>
                            {{ item.label }}
                        </option>
                    {% endfor %}
                </select>
                {% endif %}

                {% if filter_template %}
                    {% include filter_template %}
                {% endif %}
            </form>

            {# CREATE BUTTON - Nhỏ gọn #}
            {% if create_text %}
                {% if btn_color == "blue" %}
                    {% if create_url %}
                    <a href="{{ create_url }}" class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 transition-colors">
                    {% else %}
                    <button type="button" onclick="{{ create_onclick }}" class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 transition-colors">
                    {% endif %}
                {% else %}
                    {% if create_url %}
                    <a href="{{ create_url }}" class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-600 text-white text-xs font-medium rounded-md hover:bg-green-700 transition-colors">
                    {% else %}
                    <button type="button" onclick="{{ create_onclick }}" class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-green-600 text-white text-xs font-medium rounded-md hover:bg-green-700 transition-colors">
                    {% endif %}
                {% endif %}
                    <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                    </svg>
                    <span class="hidden sm:inline whitespace-nowrap">{{ create_text }}</span>
                    <span class="sm:hidden">Thêm</span>
                {% if create_url %}</a>{% else %}</button>{% endif %}
            {% endif %}
            
            {% if extra_actions_template %}
                {% include extra_actions_template %}
            {% endif %}
        </div>
    </div>
</div>